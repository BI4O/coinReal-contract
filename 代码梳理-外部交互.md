# CoinRealçš„ä»£ç æ¢³ç†v2

## å‰ç«¯å·¥ç¨‹å¸ˆæŒ‡å—ï¼šä½¿ç”¨viemè¿æ¥åˆ°App.solåˆçº¦

### æ¦‚è¿°

æœ¬æ–‡æ¡£æ—¨åœ¨æŒ‡å¯¼å‰ç«¯å·¥ç¨‹å¸ˆå¦‚ä½•ä½¿ç”¨viemåº“è¿æ¥åˆ°éƒ¨ç½²åœ¨Anvilä¸Šçš„App.solåˆçº¦ã€‚App.solæ˜¯CoinRealé¡¹ç›®çš„æ ¸å¿ƒåˆçº¦ï¼Œå®ƒæ•´åˆäº†ç”¨æˆ·ç®¡ç†ã€è¯é¢˜ç®¡ç†å’ŒåŠ¨ä½œç®¡ç†ç­‰åŠŸèƒ½ã€‚

### åˆçº¦æ¶æ„

| åˆçº¦åç§° | åŠŸèƒ½æè¿° |
| ------- | ------- |
| **App.sol** | **æ ¸å¿ƒå…¥å£åˆçº¦**ï¼Œæ•´åˆæ‰€æœ‰å­ç³»ç»Ÿï¼Œæä¾›ç»Ÿä¸€çš„å‰ç«¯æ¥å£ |
| **UserManager.sol** | ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ³¨å†Œã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤ç”¨æˆ· |
| **TopicManager.sol** | è¯é¢˜å’Œæ´»åŠ¨ç®¡ç†ç³»ç»Ÿï¼Œç»§æ‰¿TopicItemï¼Œç®¡ç†è¯é¢˜å’Œæ´»åŠ¨ç”Ÿå‘½å‘¨æœŸ |
| **ActionManager.sol** | è¯„è®ºå’Œç‚¹èµåŠ¨ä½œç®¡ç†ç³»ç»Ÿï¼Œé›†æˆAIæ ‡ç­¾å’Œå¥–åŠ±æœºåˆ¶ |
| **Campaign.sol** | æ´»åŠ¨ä»£å¸åˆçº¦ï¼ˆERC20ï¼‰ï¼Œç®¡ç†æ´»åŠ¨çš„å¥–åŠ±åˆ†é… |
| **CampaignFactory.sol** | æ´»åŠ¨ä»£å¸å·¥å‚ï¼Œä½¿ç”¨æœ€å°ä»£ç†æ¨¡å¼åˆ›å»ºæ´»åŠ¨ä»£å¸ |
| **ProjectToken.sol** | é¡¹ç›®ä»£å¸ï¼Œç”¨äºæ´»åŠ¨æ³¨èµ„ |
| **USDC.sol** | æ¨¡æ‹ŸUSDCä»£å¸ï¼Œç”¨äºæ´»åŠ¨æ³¨èµ„ |
| **TimeSerLinkArray.sol** | æ—¶é—´åºåˆ—é“¾è¡¨ï¼Œç»´æŠ¤ç”¨æˆ·æ´»åŠ¨å†å² |
| **CountSerLinkArray.sol** | ç‚¹èµæ•°æ’åºé“¾è¡¨ï¼Œç»´æŠ¤è¯„è®ºæ’è¡Œ |
| **Chainlinké›†æˆ** | åŒ…æ‹¬VRFæŠ½å¥–ã€Functions AIæ ‡ç­¾ã€Automationè‡ªåŠ¨åŒ– |

### ä½¿ç”¨viemè¿æ¥åˆ°App.solåˆçº¦

#### 1. å®‰è£…viem

```bash
pnpm install viem
```

#### 2. é…ç½®viemå®¢æˆ·ç«¯

```typescript
import { createPublicClient, http, createWalletClient, custom } from 'viem';
import { privateKeyToAccount } from 'viem/accounts';
import { anvilLocalnet } from 'viem/chains';

// é…ç½®å…¬å…±å®¢æˆ·ç«¯
const publicClient = createPublicClient({
  chain: anvilLocalnet,
  transport: http('http://localhost:8545')
});

// é…ç½®é’±åŒ…å®¢æˆ·ç«¯ï¼ˆä½¿ç”¨MetaMaskï¼‰
const walletClient = createWalletClient({
  chain: anvilLocalnet,
  transport: custom(window.ethereum)
});

// å¦‚æœä½¿ç”¨ç§é’¥ç›´æ¥è¿æ¥ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
const privateKey = '0x...'; // ä½ çš„ç§é’¥
const account = privateKeyToAccount(privateKey);

const walletClientWithAccount = createWalletClient({
  chain: anvilLocalnet,
  transport: http('http://localhost:8545'),
  account
});
```

#### 3. å®šä¹‰åˆçº¦ABI

```typescript
// App.solçš„ABI
const appAbi = [
  // ç”¨æˆ·ç®¡ç†
  {
    "inputs": [
      {"internalType": "string", "name": "_name", "type": "string"},
      {"internalType": "string", "name": "_bio", "type": "string"},
      {"internalType": "string", "name": "_email", "type": "string"}
    ],
    "name": "registerUser",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  // è¯é¢˜ç®¡ç†
  {
    "inputs": [
      {"internalType": "string", "name": "_name", "type": "string"},
      {"internalType": "string", "name": "_description", "type": "string"},
      {"internalType": "string", "name": "_tokenAddress", "type": "string"},
      {"internalType": "uint256", "name": "_tokenPrice", "type": "uint256"}
    ],
    "name": "registerTopic",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  // æ´»åŠ¨ç®¡ç†
  {
    "inputs": [
      {"internalType": "address", "name": "_sponsor", "type": "address"},
      {"internalType": "uint256", "name": "_topicId", "type": "uint256"},
      {"internalType": "string", "name": "_name", "type": "string"},
      {"internalType": "string", "name": "_description", "type": "string"},
      {"internalType": "address", "name": "_projectTokenAddr", "type": "address"}
    ],
    "name": "registerCampaign",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  // æ´»åŠ¨æ³¨èµ„
  {
    "inputs": [
      {"internalType": "uint256", "name": "_campaignId", "type": "uint256"},
      {"internalType": "uint256", "name": "_amount", "type": "uint256"}
    ],
    "name": "fundCampaignWithUSDC",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "_campaignId", "type": "uint256"},
      {"internalType": "uint256", "name": "_amount", "type": "uint256"}
    ],
    "name": "fundCampaignWithProjectToken",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  // æ´»åŠ¨å¼€å§‹/ç»“æŸ
  {
    "inputs": [
      {"internalType": "uint256", "name": "_campaignId", "type": "uint256"},
      {"internalType": "uint256", "name": "_endTime", "type": "uint256"}
    ],
    "name": "startCampaign",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "_campaignId", "type": "uint256"}
    ],
    "name": "endCampaign",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  // ç‚¹èµå’Œè¯„è®º
  {
    "inputs": [
      {"internalType": "uint256", "name": "_topicId", "type": "uint256"},
      {"internalType": "uint256", "name": "_commentId", "type": "uint256"}
    ],
    "name": "like",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "_topicId", "type": "uint256"},
      {"internalType": "string", "name": "_content", "type": "string"}
    ],
    "name": "comment",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  // æŸ¥è¯¢åŠŸèƒ½
  {
    "inputs": [
      {"internalType": "address", "name": "_userAddress", "type": "address"},
      {"internalType": "uint256", "name": "_n", "type": "uint256"}
    ],
    "name": "getUserRecentComments",
    "outputs": [{"internalType": "uint256[]", "name": "", "type": "uint256[]"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "address", "name": "_userAddress", "type": "address"},
      {"internalType": "uint256", "name": "_n", "type": "uint256"}
    ],
    "name": "getUserRecentLikes",
    "outputs": [{"internalType": "uint256[]", "name": "", "type": "uint256[]"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "uint256", "name": "_n", "type": "uint256"}],
    "name": "getMostLikedComments",
    "outputs": [{"internalType": "uint256[]", "name": "", "type": "uint256[]"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "uint256", "name": "_n", "type": "uint256"}],
    "name": "getLeastLikedComments",
    "outputs": [{"internalType": "uint256[]", "name": "", "type": "uint256[]"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "startIndex", "type": "uint256"},
      {"internalType": "uint256", "name": "length", "type": "uint256"}
    ],
    "name": "getMostLikedCommentsPaginated",
    "outputs": [{"internalType": "uint256[]", "name": "", "type": "uint256[]"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "startIndex", "type": "uint256"},
      {"internalType": "uint256", "name": "length", "type": "uint256"}
    ],
    "name": "getLeastLikedCommentsPaginated",
    "outputs": [{"internalType": "uint256[]", "name": "", "type": "uint256[]"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "getValidCommentsCount",
    "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "uint256", "name": "_commentId", "type": "uint256"}],
    "name": "getComment",
    "outputs": [{
      "components": [
        {"internalType": "uint256", "name": "id", "type": "uint256"},
        {"internalType": "address", "name": "user", "type": "address"},
        {"internalType": "uint256", "name": "topicId", "type": "uint256"},
        {"internalType": "uint256", "name": "timestamp", "type": "uint256"},
        {"internalType": "uint256", "name": "likeCount", "type": "uint256"},
        {"internalType": "bool", "name": "isDelete", "type": "bool"},
        {"internalType": "string", "name": "content", "type": "string"},
        {"internalType": "string[]", "name": "tags", "type": "string[]"}
      ],
      "internalType": "struct ActionManager.Comment",
      "name": "",
      "type": "tuple"
    }],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "uint256", "name": "_likeId", "type": "uint256"}],
    "name": "getLike",
    "outputs": [{
      "components": [
        {"internalType": "uint256", "name": "id", "type": "uint256"},
        {"internalType": "address", "name": "user", "type": "address"},
        {"internalType": "uint256", "name": "topicId", "type": "uint256"},
        {"internalType": "uint256", "name": "timestamp", "type": "uint256"},
        {"internalType": "uint256", "name": "commentId", "type": "uint256"},
        {"internalType": "bool", "name": "isCancel", "type": "bool"}
      ],
      "internalType": "struct ActionManager.Like",
      "name": "",
      "type": "tuple"
    }],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "uint256", "name": "_commentId", "type": "uint256"}],
    "name": "getCommentLikeCount",
    "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "uint256", "name": "_commentId", "type": "uint256"}],
    "name": "getCommentTags",
    "outputs": [{"internalType": "string[]", "name": "", "type": "string[]"}],
    "stateMutability": "view",
    "type": "function"
  },
  // ç®¡ç†åŠŸèƒ½
  {
    "inputs": [
      {"internalType": "uint256", "name": "_commentId", "type": "uint256"},
      {"internalType": "string[]", "name": "_tags", "type": "string[]"}
    ],
    "name": "addCommentTags",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [{"internalType": "uint256", "name": "_commentId", "type": "uint256"}],
    "name": "deleteComment",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  // AIæ ‡ç­¾åŠŸèƒ½
  {
    "inputs": [
      {"internalType": "uint256", "name": "commentId", "type": "uint256"}
    ],
    "name": "addCommentAITag",
    "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "commentId", "type": "uint256"}
    ],
    "name": "getCommentAITag",
    "outputs": [{"internalType": "string", "name": "", "type": "string"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "commentId", "type": "uint256"}
    ],
    "name": "isCommentTagAnalyzed",
    "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
    "stateMutability": "view",
    "type": "function"
  },
  // æŠ½å¥–åŠŸèƒ½
  {
    "inputs": [
      {"internalType": "uint256", "name": "campaignId", "type": "uint256"}
    ],
    "name": "performCampaignLottery",
    "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "campaignId", "type": "uint256"}
    ],
    "name": "checkCampaignLotteryNeeded",
    "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
    "stateMutability": "view",
    "type": "function"
  },
  // å¥–åŠ±æŸ¥è¯¢
  {
    "inputs": [
      {"internalType": "uint256", "name": "campaignId", "type": "uint256"},
      {"internalType": "address", "name": "user", "type": "address"}
    ],
    "name": "getExpectedReward",
    "outputs": [
      {"internalType": "uint256[2]", "name": "", "type": "uint256[2]"},
      {"internalType": "uint256[2]", "name": "", "type": "uint256[2]"}
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {"internalType": "uint256", "name": "campaignId", "type": "uint256"}
    ],
    "name": "getFundPoolInfo",
    "outputs": [
      {"internalType": "uint256[3]", "name": "", "type": "uint256[3]"},
      {"internalType": "uint256[3]", "name": "", "type": "uint256[3]"},
      {"internalType": "uint256[3]", "name": "", "type": "uint256[3]"}
    ],
    "stateMutability": "view",
    "type": "function"
  },
  // è·å–åˆçº¦åœ°å€
  {
    "inputs": [],
    "name": "userManager",
    "outputs": [{"internalType": "address", "name": "", "type": "address"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "topicManager",
    "outputs": [{"internalType": "address", "name": "", "type": "address"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "actionManager",
    "outputs": [{"internalType": "address", "name": "", "type": "address"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "usdc",
    "outputs": [{"internalType": "address", "name": "", "type": "address"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "projectToken",
    "outputs": [{"internalType": "address", "name": "", "type": "address"}],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "campaignFactory",
    "outputs": [{"internalType": "address", "name": "", "type": "address"}],
    "stateMutability": "view",
    "type": "function"
  }
];

// å…¶ä»–åˆçº¦çš„ABIä¹Ÿéœ€è¦ç±»ä¼¼å®šä¹‰
```

#### 4. ä¸åˆçº¦äº¤äº’

##### 4.1 åˆå§‹åŒ–åˆçº¦å®ä¾‹

```typescript
const appContractAddress = '0x...'; // Appåˆçº¦åœ°å€

// è¯»å–åˆçº¦æ•°æ®
async function getContractData() {
  // è·å–UserManageråœ°å€
  const userManagerAddress = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'userManager'
  });
  
  console.log('UserManageråœ°å€:', userManagerAddress);
  
  // ç±»ä¼¼åœ°è·å–å…¶ä»–ç®¡ç†åˆçº¦åœ°å€
}
```

##### 4.2 ç”¨æˆ·æ³¨å†Œ

```typescript
async function registerUser(name, bio, email) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'registerUser',
    args: [name, bio, email],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('äº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('äº¤æ˜“å·²ç¡®è®¤:', receipt);
}
```

##### 4.3 è·å–ç”¨æˆ·ä¿¡æ¯

```typescript
async function getUserInfo(userAddress) {
  // é¦–å…ˆè·å–UserManageråœ°å€
  const userManagerAddress = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'userManager'
  });
  
  // å®šä¹‰UserManagerçš„ABI
  const userManagerAbi = [
    {
      "inputs": [{"internalType": "address", "name": "_user", "type": "address"}],
      "name": "getUserInfo",
      "outputs": [{
        "components": [
          {"internalType": "uint256", "name": "id", "type": "uint256"},
          {"internalType": "string", "name": "name", "type": "string"},
          {"internalType": "string", "name": "bio", "type": "string"},
          {"internalType": "string", "name": "email", "type": "string"},
          {"internalType": "bool", "name": "registered", "type": "bool"}
        ],
        "internalType": "struct UserManager.User",
        "name": "",
        "type": "tuple"
      }],
      "stateMutability": "view",
      "type": "function"
    }
  ];
  
  // è°ƒç”¨UserManageråˆçº¦è·å–ç”¨æˆ·ä¿¡æ¯
  const userInfo = await publicClient.readContract({
    address: userManagerAddress,
    abi: userManagerAbi,
    functionName: 'getUserInfo',
    args: [userAddress]
  });
  
  return userInfo;
}
```

##### 4.4 è·å–è¯é¢˜åˆ—è¡¨

```typescript
async function getTopicsList() {
  // é¦–å…ˆè·å–TopicManageråœ°å€
  const topicManagerAddress = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'topicManager'
  });
  
  // å®šä¹‰TopicManagerçš„ABI
  const topicManagerAbi = [
    {
      "inputs": [],
      "name": "listTopics",
      "outputs": [{
        "components": [
          {"internalType": "uint256", "name": "id", "type": "uint256"},
          {"internalType": "string", "name": "name", "type": "string"},
          {"internalType": "string", "name": "description", "type": "string"},
          {"internalType": "string", "name": "tokenAddress", "type": "string"},
          {"internalType": "uint256", "name": "tokenPrice", "type": "uint256"},
          {"internalType": "address", "name": "dataFeed", "type": "address"},
          {"internalType": "uint256", "name": "commentCount", "type": "uint256"},
          {"internalType": "uint256", "name": "likeCount", "type": "uint256"}
        ],
        "internalType": "struct TopicItem.Topic[]",
        "name": "",
        "type": "tuple[]"
      }],
      "stateMutability": "view",
      "type": "function"
    }
  ];
  
  // è°ƒç”¨TopicManageråˆçº¦è·å–è¯é¢˜åˆ—è¡¨
  const topics = await publicClient.readContract({
    address: topicManagerAddress,
    abi: topicManagerAbi,
    functionName: 'listTopics'
  });
  
  return topics;
}
```

##### 4.5 å‘è¡¨è¯„è®º

```typescript
async function postComment(topicId, content) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'comment',
    args: [topicId, content],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('è¯„è®ºäº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('è¯„è®ºå·²ç¡®è®¤:', receipt);
}
```

##### 4.6 ç‚¹èµè¯„è®º

```typescript
async function likeComment(topicId, commentId) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'like',
    args: [topicId, commentId],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('ç‚¹èµäº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('ç‚¹èµå·²ç¡®è®¤:', receipt);
}
```

##### 4.7 åˆ›å»ºæ´»åŠ¨

```typescript
async function createCampaign(sponsor, topicId, name, description, projectTokenAddr) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'registerCampaign',
    args: [sponsor, topicId, name, description, projectTokenAddr],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('åˆ›å»ºæ´»åŠ¨äº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('æ´»åŠ¨å·²åˆ›å»º:', receipt);
}
```

##### 4.8 æ´»åŠ¨æ³¨èµ„

```typescript
async function fundCampaignWithUSDC(campaignId, amount) {
  // é¦–å…ˆè·å–USDCåœ°å€
  const usdcAddress = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'usdc'
  });
  
  // å®šä¹‰USDCçš„ABI
  const usdcAbi = [
    {
      "inputs": [
        {"internalType": "address", "name": "spender", "type": "address"},
        {"internalType": "uint256", "name": "amount", "type": "uint256"}
      ],
      "name": "approve",
      "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
      "stateMutability": "nonpayable",
      "type": "function"
    }
  ];
  
  // é¦–å…ˆæ‰¹å‡†Appåˆçº¦ä½¿ç”¨USDC
  const { request: approveRequest } = await publicClient.simulateContract({
    address: usdcAddress,
    abi: usdcAbi,
    functionName: 'approve',
    args: [appContractAddress, amount],
    account: walletClient.account
  });
  
  const approveHash = await walletClient.writeContract(approveRequest);
  await publicClient.waitForTransactionReceipt({ hash: approveHash });
  
  // ç„¶åè°ƒç”¨æ³¨èµ„å‡½æ•°
  const { request: fundRequest } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'fundCampaignWithUSDC',
    args: [campaignId, amount],
    account: walletClient.account
  });
  
  const fundHash = await walletClient.writeContract(fundRequest);
  console.log('æ³¨èµ„äº¤æ˜“å“ˆå¸Œ:', fundHash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash: fundHash });
  console.log('æ³¨èµ„å·²ç¡®è®¤:', receipt);
}
```

##### 4.9 å¯åŠ¨æ´»åŠ¨

```typescript
async function startCampaign(campaignId, endTime) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'startCampaign',
    args: [campaignId, endTime],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('å¯åŠ¨æ´»åŠ¨äº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('æ´»åŠ¨å·²å¯åŠ¨:', receipt);
}
```

##### 4.10 ç»“æŸæ´»åŠ¨

```typescript
async function endCampaign(campaignId) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'endCampaign',
    args: [campaignId],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('ç»“æŸæ´»åŠ¨äº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('æ´»åŠ¨å·²ç»“æŸ:', receipt);
}
```

#### 5. æ–°å¢æŸ¥è¯¢åŠŸèƒ½

##### 5.1 è·å–ç”¨æˆ·æœ€è¿‘è¯„è®º

```typescript
async function getUserRecentComments(userAddress, count) {
  const recentComments = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getUserRecentComments',
    args: [userAddress, count]
  });
  
  console.log('ç”¨æˆ·æœ€è¿‘è¯„è®ºID:', recentComments);
  return recentComments;
}
```

##### 5.2 è·å–ç”¨æˆ·æœ€è¿‘ç‚¹èµ

```typescript
async function getUserRecentLikes(userAddress, count) {
  const recentLikes = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getUserRecentLikes',
    args: [userAddress, count]
  });
  
  console.log('ç”¨æˆ·æœ€è¿‘ç‚¹èµID:', recentLikes);
  return recentLikes;
}
```

##### 5.3 è·å–æœ€å¤šç‚¹èµçš„è¯„è®º

```typescript
async function getMostLikedComments(count) {
  const mostLiked = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getMostLikedComments',
    args: [count]
  });
  
  console.log('æœ€å¤šç‚¹èµè¯„è®ºID:', mostLiked);
  return mostLiked;
}
```

##### 5.4 åˆ†é¡µè·å–æœ€å¤šç‚¹èµçš„è¯„è®º

```typescript
async function getMostLikedCommentsPaginated(startIndex, length) {
  const paginatedComments = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getMostLikedCommentsPaginated',
    args: [startIndex, length]
  });
  
  console.log('åˆ†é¡µè¯„è®ºID:', paginatedComments);
  return paginatedComments;
}
```

##### 5.5 è·å–æœ‰æ•ˆè¯„è®ºæ€»æ•°

```typescript
async function getValidCommentsCount() {
  const count = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getValidCommentsCount'
  });
  
  console.log('æœ‰æ•ˆè¯„è®ºæ€»æ•°:', count);
  return count;
}
```

##### 5.6 è·å–è¯„è®ºè¯¦æƒ…

```typescript
async function getCommentDetails(commentId) {
  const comment = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getComment',
    args: [commentId]
  });
  
  console.log('è¯„è®ºè¯¦æƒ…:', {
    id: comment.id,
    user: comment.user,
    topicId: comment.topicId,
    timestamp: new Date(Number(comment.timestamp) * 1000),
    likeCount: comment.likeCount,
    isDeleted: comment.isDelete,
    content: comment.content,
    tags: comment.tags
  });
  
  return comment;
}
```

##### 5.7 è·å–ç‚¹èµè¯¦æƒ…

```typescript
async function getLikeDetails(likeId) {
  const like = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getLike',
    args: [likeId]
  });
  
  console.log('ç‚¹èµè¯¦æƒ…:', {
    id: like.id,
    user: like.user,
    topicId: like.topicId,
    timestamp: new Date(Number(like.timestamp) * 1000),
    commentId: like.commentId,
    isCanceled: like.isCancel
  });
  
  return like;
}
```

##### 5.8 ç®¡ç†å‘˜æ·»åŠ è¯„è®ºæ ‡ç­¾

```typescript
async function addCommentTags(commentId, tags) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'addCommentTags',
    args: [commentId, tags],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('æ·»åŠ æ ‡ç­¾äº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('æ ‡ç­¾å·²æ·»åŠ :', receipt);
}
```

##### 5.9 åˆ é™¤è¯„è®º

```typescript
async function deleteComment(commentId) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'deleteComment',
    args: [commentId],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('åˆ é™¤è¯„è®ºäº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('è¯„è®ºå·²åˆ é™¤:', receipt);
}
```

##### 5.10 AIæ ‡ç­¾åŠŸèƒ½

```typescript
// ä¸ºè¯„è®ºæ·»åŠ AIæƒ…æ„Ÿåˆ†ææ ‡ç­¾
async function addCommentAITag(commentId) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'addCommentAITag',
    args: [commentId],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('AIæ ‡ç­¾è¯·æ±‚äº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('AIæ ‡ç­¾è¯·æ±‚å·²å‘é€:', receipt);
}

// è·å–è¯„è®ºçš„AIæƒ…æ„Ÿæ ‡ç­¾
async function getCommentAITag(commentId) {
  const tag = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getCommentAITag',
    args: [commentId]
  });
  
  console.log('AIæ ‡ç­¾:', tag); // POS/NEG/NEU
  return tag;
}

// æ£€æŸ¥è¯„è®ºæ˜¯å¦å·²å®ŒæˆAIåˆ†æ
async function isCommentTagAnalyzed(commentId) {
  const analyzed = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'isCommentTagAnalyzed',
    args: [commentId]
  });
  
  return analyzed;
}
```

##### 5.11 æ´»åŠ¨æŠ½å¥–åŠŸèƒ½

```typescript
// æ‰§è¡Œæ´»åŠ¨æŠ½å¥–
async function performCampaignLottery(campaignId) {
  const { request } = await publicClient.simulateContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'performCampaignLottery',
    args: [campaignId],
    account: walletClient.account
  });
  
  const hash = await walletClient.writeContract(request);
  console.log('æŠ½å¥–äº¤æ˜“å“ˆå¸Œ:', hash);
  
  // ç­‰å¾…äº¤æ˜“ç¡®è®¤
  const receipt = await publicClient.waitForTransactionReceipt({ hash });
  console.log('æŠ½å¥–å·²å®Œæˆ:', receipt);
}

// æ£€æŸ¥æ´»åŠ¨æ˜¯å¦éœ€è¦æ‰§è¡ŒæŠ½å¥–
async function checkCampaignLotteryNeeded(campaignId) {
  const needed = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'checkCampaignLotteryNeeded',
    args: [campaignId]
  });
  
  return needed;
}
```

##### 5.12 å¥–åŠ±æŸ¥è¯¢åŠŸèƒ½

```typescript
// è·å–ç”¨æˆ·é¢„æœŸå¥–åŠ±
async function getExpectedReward(campaignId, userAddress) {
  const rewards = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getExpectedReward',
    args: [campaignId, userAddress]
  });
  
  const [worstCase, bestCase] = rewards;
  console.log('æœ€å·®æƒ…å†µå¥–åŠ± [USDC, ProjectToken]:', worstCase);
  console.log('æœ€å¥½æƒ…å†µå¥–åŠ± [USDC, ProjectToken]:', bestCase);
  
  return { worstCase, bestCase };
}

// è·å–æ´»åŠ¨å¥–æ± ä¿¡æ¯
async function getFundPoolInfo(campaignId) {
  const poolInfo = await publicClient.readContract({
    address: appContractAddress,
    abi: appAbi,
    functionName: 'getFundPoolInfo',
    args: [campaignId]
  });
  
  const [qualityPool, lotteryPool, campaignPool] = poolInfo;
  console.log('è´¨é‡è¯„è®ºè€…å¥–æ±  [äººæ•°, USDC, ProjectToken]:', qualityPool);
  console.log('ç‚¹èµæŠ½å¥–å¥–æ±  [äººæ•°, USDC, ProjectToken]:', lotteryPool);
  console.log('CampaignTokenå¥–æ±  [æ€»å‚ä¸è€…, USDC, ProjectToken]:', campaignPool);
  
  return { qualityPool, lotteryPool, campaignPool };
}
```

#### 5. ç›‘å¬åˆçº¦äº‹ä»¶

è™½ç„¶App.solåˆçº¦æœ¬èº«æ²¡æœ‰å®šä¹‰äº‹ä»¶ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç›‘å¬äº¤æ˜“ç¡®è®¤æ¥è·Ÿè¸ªæ“ä½œçš„å®Œæˆï¼š

```typescript
async function watchTransactionConfirmation(hash) {
  const unwatch = publicClient.watchTransactionReceipt(
    { hash },
    (receipt) => {
      console.log('äº¤æ˜“å·²ç¡®è®¤:', receipt);
      unwatch(); // åœæ­¢ç›‘å¬
    }
  );
}
```

#### 6. å®Œæ•´çš„Reacté›†æˆç¤ºä¾‹

```tsx
import React, { useState, useEffect } from 'react';
import { createPublicClient, http, createWalletClient, custom } from 'viem';
import { anvilLocalnet } from 'viem/chains';

// é…ç½®å®¢æˆ·ç«¯
const publicClient = createPublicClient({
  chain: anvilLocalnet,
  transport: http('http://localhost:8545')
});

const walletClient = createWalletClient({
  chain: anvilLocalnet,
  transport: custom(window.ethereum)
});

// Appåˆçº¦ABIå’Œåœ°å€
const appAbi = [...]; // å®Œæ•´çš„ABIå®šä¹‰
const appContractAddress = '0x...'; // éƒ¨ç½²çš„Appåˆçº¦åœ°å€

function CoinRealApp() {
  const [account, setAccount] = useState(null);
  const [topics, setTopics] = useState([]);
  const [userInfo, setUserInfo] = useState(null);
  const [loading, setLoading] = useState(false);
  const [userComments, setUserComments] = useState([]);
  const [userLikes, setUserLikes] = useState([]);
  const [mostLikedComments, setMostLikedComments] = useState([]);
  const [commentsPage, setCommentsPage] = useState(0);
  const [totalComments, setTotalComments] = useState(0);
  
  // è¿æ¥é’±åŒ…
  async function connectWallet() {
    try {
      const [address] = await window.ethereum.request({ method: 'eth_requestAccounts' });
      setAccount(address);
      
      // è·å–ç”¨æˆ·ä¿¡æ¯
      if (address) {
        const info = await getUserInfo(address);
        setUserInfo(info);
      }
    } catch (error) {
      console.error('è¿æ¥é’±åŒ…å¤±è´¥:', error);
    }
  }
  
  // è·å–ç”¨æˆ·ä¿¡æ¯
  async function getUserInfo(address) {
    try {
      const userManagerAddress = await publicClient.readContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'userManager'
      });
      
      const userManagerAbi = [...]; // UserManagerçš„ABI
      
      const info = await publicClient.readContract({
        address: userManagerAddress,
        abi: userManagerAbi,
        functionName: 'getUserInfo',
        args: [address]
      });
      
      return info;
    } catch (error) {
      console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
      return null;
    }
  }
  
  // è·å–è¯é¢˜åˆ—è¡¨
  async function fetchTopics() {
    try {
      setLoading(true);
      const topicManagerAddress = await publicClient.readContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'topicManager'
      });
      
      const topicManagerAbi = [...]; // TopicManagerçš„ABI
      
      const topicsList = await publicClient.readContract({
        address: topicManagerAddress,
        abi: topicManagerAbi,
        functionName: 'listTopics'
      });
      
      setTopics(topicsList);
    } catch (error) {
      console.error('è·å–è¯é¢˜åˆ—è¡¨å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  }
  
  // æ³¨å†Œç”¨æˆ·
  async function handleRegisterUser(name, bio, email) {
    try {
      setLoading(true);
      
      const { request } = await publicClient.simulateContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'registerUser',
        args: [name, bio, email],
        account
      });
      
      const hash = await walletClient.writeContract(request);
      console.log('æ³¨å†Œç”¨æˆ·äº¤æ˜“å“ˆå¸Œ:', hash);
      
      // ç­‰å¾…äº¤æ˜“ç¡®è®¤
      const receipt = await publicClient.waitForTransactionReceipt({ hash });
      console.log('ç”¨æˆ·æ³¨å†Œå·²ç¡®è®¤:', receipt);
      
      // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
      const info = await getUserInfo(account);
      setUserInfo(info);
    } catch (error) {
      console.error('æ³¨å†Œç”¨æˆ·å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  }
  
  // å‘è¡¨è¯„è®º
  async function handlePostComment(topicId, content) {
    try {
      setLoading(true);
      
      const { request } = await publicClient.simulateContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'comment',
        args: [topicId, content],
        account
      });
      
      const hash = await walletClient.writeContract(request);
      console.log('è¯„è®ºäº¤æ˜“å“ˆå¸Œ:', hash);
      
      // ç­‰å¾…äº¤æ˜“ç¡®è®¤
      const receipt = await publicClient.waitForTransactionReceipt({ hash });
      console.log('è¯„è®ºå·²ç¡®è®¤:', receipt);
      
      // åˆ·æ–°è¯é¢˜åˆ—è¡¨
      fetchTopics();
    } catch (error) {
      console.error('å‘è¡¨è¯„è®ºå¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  }
  
  // è·å–ç”¨æˆ·æ´»åŠ¨å†å²
  async function fetchUserActivity() {
    if (!account) return;
    
    try {
      // è·å–ç”¨æˆ·æœ€è¿‘10ä¸ªè¯„è®º
      const recentComments = await publicClient.readContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'getUserRecentComments',
        args: [account, 10]
      });
      
      // è·å–ç”¨æˆ·æœ€è¿‘10ä¸ªç‚¹èµ
      const recentLikes = await publicClient.readContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'getUserRecentLikes',
        args: [account, 10]
      });
      
      setUserComments(recentComments);
      setUserLikes(recentLikes);
    } catch (error) {
      console.error('è·å–ç”¨æˆ·æ´»åŠ¨å¤±è´¥:', error);
    }
  }
  
  // è·å–çƒ­é—¨è¯„è®º
  async function fetchMostLikedComments() {
    try {
      const mostLiked = await publicClient.readContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'getMostLikedComments',
        args: [10]
      });
      
      const total = await publicClient.readContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'getValidCommentsCount'
      });
      
      setMostLikedComments(mostLiked);
      setTotalComments(Number(total));
    } catch (error) {
      console.error('è·å–çƒ­é—¨è¯„è®ºå¤±è´¥:', error);
    }
  }
  
  // åˆ†é¡µè·å–è¯„è®º
  async function fetchCommentsPaginated(page = 0, pageSize = 10) {
    try {
      const startIndex = page * pageSize;
      const paginatedComments = await publicClient.readContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'getMostLikedCommentsPaginated',
        args: [startIndex, pageSize]
      });
      
      setMostLikedComments(paginatedComments);
      setCommentsPage(page);
    } catch (error) {
      console.error('åˆ†é¡µè·å–è¯„è®ºå¤±è´¥:', error);
    }
  }
  
  // è·å–è¯„è®ºè¯¦æƒ…
  async function getCommentDetails(commentId) {
    try {
      const comment = await publicClient.readContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'getComment',
        args: [commentId]
      });
      
      return {
        id: comment.id,
        user: comment.user,
        topicId: comment.topicId,
        timestamp: new Date(Number(comment.timestamp) * 1000),
        likeCount: comment.likeCount,
        isDeleted: comment.isDelete,
        content: comment.content,
        tags: comment.tags
      };
    } catch (error) {
      console.error('è·å–è¯„è®ºè¯¦æƒ…å¤±è´¥:', error);
      return null;
    }
  }
  
  // åˆ é™¤è¯„è®º
  async function handleDeleteComment(commentId) {
    try {
      setLoading(true);
      
      const { request } = await publicClient.simulateContract({
        address: appContractAddress,
        abi: appAbi,
        functionName: 'deleteComment',
        args: [commentId],
        account
      });
      
      const hash = await walletClient.writeContract(request);
      console.log('åˆ é™¤è¯„è®ºäº¤æ˜“å“ˆå¸Œ:', hash);
      
      // ç­‰å¾…äº¤æ˜“ç¡®è®¤
      const receipt = await publicClient.waitForTransactionReceipt({ hash });
      console.log('è¯„è®ºå·²åˆ é™¤:', receipt);
      
      // åˆ·æ–°æ•°æ®
      fetchUserActivity();
      fetchMostLikedComments();
    } catch (error) {
      console.error('åˆ é™¤è¯„è®ºå¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  }
  
  // åˆå§‹åŒ–åŠ è½½
  useEffect(() => {
    connectWallet();
    fetchTopics();
    fetchMostLikedComments();
  }, []);
  
  // å½“è´¦æˆ·å˜åŒ–æ—¶è·å–ç”¨æˆ·æ´»åŠ¨
  useEffect(() => {
    if (account) {
      fetchUserActivity();
    }
  }, [account]);
  
  return (
    <div className="app">
      <header>
        <h1>CoinReal</h1>
        <div className="wallet">
          {account ? (
            <span>å·²è¿æ¥: {account.substring(0, 6)}...{account.substring(38)}</span>
          ) : (
            <button onClick={connectWallet}>è¿æ¥é’±åŒ…</button>
          )}
        </div>
      </header>
      
      <main>
        {/* ç”¨æˆ·ä¿¡æ¯ */}
        <section className="user-info">
          {userInfo ? (
            <div>
              <h2>{userInfo.name}</h2>
              <p>{userInfo.bio}</p>
              <p>{userInfo.email}</p>
            </div>
          ) : account ? (
            <div className="register-form">
              <h2>æ³¨å†Œç”¨æˆ·</h2>
              {/* æ³¨å†Œè¡¨å• */}
            </div>
          ) : (
            <p>è¯·è¿æ¥é’±åŒ…</p>
          )}
        </section>
        
        {/* ç”¨æˆ·æ´»åŠ¨å†å² */}
        {account && userInfo && (
          <section className="user-activity">
            <h2>æˆ‘çš„æ´»åŠ¨</h2>
            <div className="activity-tabs">
              <div className="comments-tab">
                <h3>æœ€è¿‘è¯„è®º ({userComments.length})</h3>
                <ul>
                  {userComments.map((commentId) => (
                    <CommentItem 
                      key={commentId} 
                      commentId={commentId} 
                      onDelete={handleDeleteComment}
                      getDetails={getCommentDetails}
                    />
                  ))}
                </ul>
              </div>
              <div className="likes-tab">
                <h3>æœ€è¿‘ç‚¹èµ ({userLikes.length})</h3>
                <ul>
                  {userLikes.map((likeId) => (
                    <LikeItem 
                      key={likeId} 
                      likeId={likeId}
                    />
                  ))}
                </ul>
              </div>
            </div>
          </section>
        )}
        
        {/* çƒ­é—¨è¯„è®º */}
        <section className="hot-comments">
          <h2>çƒ­é—¨è¯„è®º</h2>
          <div className="pagination-controls">
            <button 
              onClick={() => fetchCommentsPaginated(commentsPage - 1)}
              disabled={commentsPage === 0}
            >
              ä¸Šä¸€é¡µ
            </button>
            <span>ç¬¬ {commentsPage + 1} é¡µ</span>
            <button 
              onClick={() => fetchCommentsPaginated(commentsPage + 1)}
              disabled={(commentsPage + 1) * 10 >= totalComments}
            >
              ä¸‹ä¸€é¡µ
            </button>
            <span>æ€»è®¡ {totalComments} æ¡è¯„è®º</span>
          </div>
          {loading ? (
            <p>åŠ è½½ä¸­...</p>
          ) : (
            <ul>
              {mostLikedComments.map((commentId) => (
                <CommentItem 
                  key={commentId} 
                  commentId={commentId}
                  getDetails={getCommentDetails}
                  showActions={false}
                />
              ))}
            </ul>
          )}
        </section>
        
        {/* è¯é¢˜åˆ—è¡¨ */}
        <section className="topics">
          <h2>è¯é¢˜åˆ—è¡¨</h2>
          {loading ? (
            <p>åŠ è½½ä¸­...</p>
          ) : (
            <ul>
              {topics.map((topic) => (
                <li key={topic.id}>
                  <h3>{topic.name}</h3>
                  <p>{topic.description}</p>
                  <div>
                    <span>è¯„è®ºæ•°: {topic.commentCount}</span>
                    <span>ç‚¹èµæ•°: {topic.likeCount}</span>
                  </div>
                  {/* è¯„è®ºè¡¨å• */}
                </li>
              ))}
            </ul>
          )}
        </section>
      </main>
    </div>
  );
}

// è¯„è®ºç»„ä»¶
function CommentItem({ commentId, onDelete, getDetails, showActions = true }) {
  const [comment, setComment] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    async function fetchComment() {
      const details = await getDetails(commentId);
      setComment(details);
      setLoading(false);
    }
    fetchComment();
  }, [commentId]);
  
  if (loading) return <li>åŠ è½½ä¸­...</li>;
  if (!comment) return <li>è¯„è®ºä¸å­˜åœ¨</li>;
  
  return (
    <li className="comment-item">
      <div className="comment-header">
        <span className="user">{comment.user.substring(0, 6)}...{comment.user.substring(38)}</span>
        <span className="timestamp">{comment.timestamp.toLocaleString()}</span>
        <span className="likes">ğŸ‘ {comment.likeCount}</span>
      </div>
      <div className="comment-content">
        {comment.content}
      </div>
      {comment.tags.length > 0 && (
        <div className="comment-tags">
          {comment.tags.map((tag, index) => (
            <span key={index} className="tag">#{tag}</span>
          ))}
        </div>
      )}
      {showActions && (
        <div className="comment-actions">
          <button onClick={() => onDelete(commentId)}>åˆ é™¤</button>
        </div>
      )}
    </li>
  );
}

// ç‚¹èµç»„ä»¶
function LikeItem({ likeId }) {
  const [like, setLike] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    async function fetchLike() {
      try {
        const likeDetails = await publicClient.readContract({
          address: appContractAddress,
          abi: appAbi,
          functionName: 'getLike',
          args: [likeId]
        });
        
        setLike({
          id: likeDetails.id,
          user: likeDetails.user,
          topicId: likeDetails.topicId,
          timestamp: new Date(Number(likeDetails.timestamp) * 1000),
          commentId: likeDetails.commentId,
          isCanceled: likeDetails.isCancel
        });
      } catch (error) {
        console.error('è·å–ç‚¹èµè¯¦æƒ…å¤±è´¥:', error);
      } finally {
        setLoading(false);
      }
    }
    fetchLike();
  }, [likeId]);
  
  if (loading) return <li>åŠ è½½ä¸­...</li>;
  if (!like) return <li>ç‚¹èµä¸å­˜åœ¨</li>;
  
  return (
    <li className="like-item">
      <div className="like-info">
        <span>ç‚¹èµäº†è¯„è®º #{like.commentId}</span>
        <span className="timestamp">{like.timestamp.toLocaleString()}</span>
      </div>
    </li>
  );
}

export default CoinRealApp;
```

### æ–°å¢åŠŸèƒ½æ€»ç»“

#### ç”¨æˆ·æ´»åŠ¨è¿½è¸ª
- **getUserRecentComments**: è·å–ç”¨æˆ·æœ€è¿‘çš„è¯„è®ºå†å²
- **getUserRecentLikes**: è·å–ç”¨æˆ·æœ€è¿‘çš„ç‚¹èµå†å²
- åŸºäºTimeSerLinkArrayé“¾è¡¨å®ç°ï¼ŒO(1)æ—¶é—´å¤æ‚åº¦æ·»åŠ ï¼Œé«˜æ•ˆæŸ¥è¯¢æœ€è¿‘æ´»åŠ¨

#### è¯„è®ºæ’è¡ŒåŠŸèƒ½
- **getMostLikedComments**: è·å–ç‚¹èµæ•°æœ€å¤šçš„è¯„è®º
- **getLeastLikedComments**: è·å–ç‚¹èµæ•°æœ€å°‘çš„è¯„è®º
- åŸºäºCountSerLinkArrayæœ‰åºé“¾è¡¨ï¼Œè‡ªåŠ¨è¿‡æ»¤å·²åˆ é™¤è¯„è®º
- æ”¯æŒè‡ªå®šä¹‰è¿”å›æ•°é‡å’Œåˆ†é¡µæŸ¥è¯¢

#### åˆ†é¡µæŸ¥è¯¢æ”¯æŒ
- **getMostLikedCommentsPaginated**: åˆ†é¡µè·å–æœ€å¤šç‚¹èµè¯„è®º
- **getRecentCommentsPaginated**: åˆ†é¡µè·å–æœ€è¿‘è¯„è®ºï¼ˆå…¨å±€æ—¶é—´åºåˆ—ï¼‰
- **getValidCommentsCount**: è·å–æœ‰æ•ˆè¯„è®ºæ€»æ•°
- **getGlobalCommentsCount**: è·å–å…¨å±€è¯„è®ºæ€»æ•°
- é¿å…ä¸€æ¬¡æ€§è¿”å›å¤§é‡æ•°æ®ï¼Œæé«˜æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

#### è¯¦ç»†ä¿¡æ¯æŸ¥è¯¢
- **getComment**: è·å–å®Œæ•´çš„è¯„è®ºä¿¡æ¯ï¼ˆåŒ…æ‹¬æ ‡ç­¾ã€ç‚¹èµæ•°ç­‰ï¼‰
- **getLike**: è·å–ç‚¹èµçš„è¯¦ç»†ä¿¡æ¯
- **getCommentTags**: è·å–è¯„è®ºçš„æ ‡ç­¾åˆ—è¡¨
- **getCommentLikeCount**: è·å–è¯„è®ºçš„ç‚¹èµæ•°

#### Chainlinké›†æˆåŠŸèƒ½
- **addCommentAITag**: ä½¿ç”¨Chainlink Functionsä¸ºè¯„è®ºæ·»åŠ AIæƒ…æ„Ÿåˆ†ææ ‡ç­¾
- **getCommentAITag**: è·å–è¯„è®ºçš„AIæƒ…æ„Ÿæ ‡ç­¾ï¼ˆPOS/NEG/NEUï¼‰
- **performCampaignLottery**: ä½¿ç”¨Chainlink VRFæ‰§è¡Œæ´»åŠ¨éšæœºæŠ½å¥–
- **checkCampaignLotteryNeeded**: æ£€æŸ¥æ´»åŠ¨æ˜¯å¦éœ€è¦æ‰§è¡ŒæŠ½å¥–
- æ”¯æŒChainlink Automationè‡ªåŠ¨åŒ–æ‰¹å¤„ç†

#### å¥–åŠ±ç³»ç»ŸæŸ¥è¯¢
- **getExpectedReward**: è·å–ç”¨æˆ·åœ¨ç‰¹å®šæ´»åŠ¨ä¸­çš„é¢„æœŸå¥–åŠ±èŒƒå›´
- **getFundPoolInfo**: è·å–æ´»åŠ¨çš„å¥–æ± åˆ†é…ä¿¡æ¯
- æ”¯æŒå®æ—¶æŸ¥è¯¢æœ€å·®å’Œæœ€å¥½æƒ…å†µä¸‹çš„å¥–åŠ±ä¼°ç®—

#### ç®¡ç†åŠŸèƒ½
- **addCommentTags**: ç®¡ç†å‘˜å¯ä¸ºè¯„è®ºæ·»åŠ æ ‡ç­¾
- **deleteComment**: ç”¨æˆ·å¯åˆ é™¤è‡ªå·±çš„è¯„è®º
- **withdrawPlatformFees**: ç®¡ç†å‘˜æå–å¹³å°è´¹ç”¨
- å®Œæ•´çš„æƒé™æ§åˆ¶å’Œå®‰å…¨æ£€æŸ¥

#### æŠ€æœ¯ç‰¹ç‚¹
1. **é«˜æ•ˆæ•°æ®ç»“æ„**: 
   - TimeSerLinkArrayï¼šæ—¶é—´åºåˆ—åŒå‘é“¾è¡¨ï¼Œç»´æŠ¤ç”¨æˆ·å’Œå…¨å±€æ´»åŠ¨å†å²
   - CountSerLinkArrayï¼šç‚¹èµæ•°æ’åºé“¾è¡¨ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°å’Œæœ‰åºæŸ¥è¯¢
2. **åˆ†é¡µæ”¯æŒ**: é¿å…gasæ¶ˆè€—è¿‡é«˜ï¼Œæ”¯æŒçµæ´»çš„åˆ†é¡µæŸ¥è¯¢
3. **Chainlinké›†æˆ**: 
   - Functionsï¼šå¤–éƒ¨AIæœåŠ¡è°ƒç”¨
   - VRFï¼šå®‰å…¨éšæœºæ•°ç”Ÿæˆ
   - Automationï¼šè‡ªåŠ¨åŒ–ä»»åŠ¡æ‰§è¡Œ
4. **å¥–åŠ±æœºåˆ¶**: å¤šå±‚æ¬¡å¥–åŠ±åˆ†é…ï¼ŒåŒ…æ‹¬è¯„è®ºå¥–åŠ±ã€ç‚¹èµå¥–åŠ±ã€è´¨é‡è¯„è®ºè€…å¥–åŠ±å’ŒæŠ½å¥–å¥–åŠ±
5. **å®‰å…¨è®¾è®¡**: å®Œå–„çš„æƒé™æ§åˆ¶ã€é‡å…¥æ”»å‡»é˜²æŠ¤å’Œé”™è¯¯å¤„ç†
6. **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œé›†æˆç¬¬ä¸‰æ–¹æœåŠ¡

### æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨viemåº“è¿æ¥åˆ°éƒ¨ç½²åœ¨Anvilä¸Šçš„App.solåˆçº¦ï¼ŒåŒ…æ‹¬é…ç½®å®¢æˆ·ç«¯ã€å®šä¹‰åˆçº¦ABIã€ä¸åˆçº¦äº¤äº’ä»¥åŠç›‘å¬åˆçº¦äº‹ä»¶ã€‚

#### æ›´æ–°åçš„ä¸»è¦åŠŸèƒ½äº®ç‚¹

1. **å®Œæ•´çš„ç¤¾äº¤ç³»ç»Ÿ**: ç”¨æˆ·æ³¨å†Œã€è¯„è®ºã€ç‚¹èµï¼Œæ”¯æŒç”¨æˆ·æ´»åŠ¨å†å²è¿½è¸ª
2. **é«˜æ•ˆçš„æ•°æ®ç»“æ„**: 
   - æ—¶é—´åºåˆ—é“¾è¡¨ç»´æŠ¤ç”¨æˆ·å’Œå…¨å±€æ´»åŠ¨å†å²
   - ç‚¹èµæ•°æ’åºé“¾è¡¨æ”¯æŒå®æ—¶æ’è¡Œæ¦œ
3. **Chainlinkæ·±åº¦é›†æˆ**:
   - Functionsï¼šAIæƒ…æ„Ÿåˆ†ææ ‡ç­¾è‡ªåŠ¨åŒ–
   - VRFï¼šå…¬å¹³çš„éšæœºæŠ½å¥–æœºåˆ¶
   - Automationï¼šæ‰¹å¤„ç†å’Œå®šæ—¶ä»»åŠ¡
4. **å¤šå±‚æ¬¡å¥–åŠ±æœºåˆ¶**:
   - å®æ—¶æŸ¥è¯¢é¢„æœŸå¥–åŠ±èŒƒå›´
   - è´¨é‡è¯„è®ºè€…å¥–åŠ±åˆ†é…
   - ç‚¹èµè€…éšæœºæŠ½å¥–
   - æŒ‰CP tokenæ¯”ä¾‹åˆ†é…å¥–æ± 
5. **å‰ç«¯å‹å¥½çš„è®¾è®¡**:
   - åˆ†é¡µæŸ¥è¯¢é¿å…æ•°æ®è¿‡è½½
   - ç»Ÿä¸€çš„App.solå…¥å£ç®€åŒ–é›†æˆ
   - å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€æŸ¥è¯¢

é€šè¿‡è¿™äº›å‡çº§ï¼ŒCoinRealä¸ä»…æä¾›äº†å®Œæ•´çš„ç¤¾äº¤åŒ–DeFiåŸºç¡€è®¾æ–½ï¼Œè¿˜é›†æˆäº†å‰æ²¿çš„Web3æŠ€æœ¯ï¼Œä¸ºæ„å»ºä¸‹ä¸€ä»£å»ä¸­å¿ƒåŒ–ç¤¾äº¤åº”ç”¨æä¾›äº†å¼ºå¤§çš„æŠ€æœ¯æ”¯æ’‘ã€‚å‰ç«¯å·¥ç¨‹å¸ˆå¯ä»¥é€šè¿‡æœ¬æ–‡æ¡£çš„æŒ‡å—ï¼Œè½»æ¾å®ç°ä»åŸºç¡€çš„ç”¨æˆ·äº¤äº’åˆ°é«˜çº§çš„AIåˆ†æå’Œè‡ªåŠ¨åŒ–åŠŸèƒ½çš„å®Œæ•´é›†æˆã€‚
        

